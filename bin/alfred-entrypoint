#!/bin/bash

set -e

workflow_dir="$(dirname "$0")/.."

log_file="$HOME/.local/state/bktide/logs/alfred.log"
mkdir -p "$(dirname "$log_file")"

export PATH=$HOME/.local/share/mise/shims:$PATH

command="$1"
if [[ -z "$command" ]]; then
  echo "Usage: $0 <command> [filter]"
  exit 1
fi

filter="$2"
args=(--format alfred)
if [[ -n "$filter" ]]; then
  args+=(--filter "$filter")
fi
echo "Running command: node dist/index.js $command" "${args[@]}" >> "$log_file"
node "$workflow_dir/dist/index.js" "$command" "${args[@]}" 2>&1 | tee -a "$log_file"