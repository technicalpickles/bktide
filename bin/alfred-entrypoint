#!/bin/bash

set -e
set -x

workflow_dir="$(dirname "$0")/.."
log_file="$HOME/.local/state/bktide/logs/alfred.log"
mkdir -p "$(dirname "$log_file")"

export PATH="$HOME/.local/share/mise/shims:$PATH"

command="$1"
shift

if [[ -z "$command" ]]; then
  echo "Usage: $0 <command> [filter]"
  exit 1
fi

if [[ -z "$NODE_BIN" ]]; then
  export NODE_BIN=node
fi

echo "Running command: $NODE_BIN $workflow_dir/dist/index.js $command" "$@" >> "$log_file"
"$NODE_BIN" "$workflow_dir/dist/index.js" "$command" --format alfred "$@" 2>&1 | tee -a "$log_file"